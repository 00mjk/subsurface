#!/bin/bash
# Hash is 3A8CE62A483083EDEA5581A61E770EC1FA8BECE8 but it doesn't seem to
# find the key by hash

echo -- copy over the Info.plist files
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtCore.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtCore.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtGui.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtGui.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtNetwork.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtNetwork.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtScript.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtScript.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtSql.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtSql.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtSvg.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtSvg.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtWebKit.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtWebKit.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtMultimedia.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtMultimedia.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtMultimediaWidgets.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtMultimediaWidgets.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtOpenGL.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtOpenGL.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtPositioning.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtPositioning.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtPrintSupport.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtPrintSupport.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtQml.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtQml.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtQuick.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtQuick.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtSensors.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtSensors.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtWebKitWidgets.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtWebKitWidgets.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtWidgets.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtWidgets.framework/Resources/
cp ~/Qt5.2.0/5.2.0/clang_64/lib/QtXml.framework/Contents/Info.plist staging/Subsurface.app/Contents/Frameworks/QtXml.framework/Resources/

echo -- signing staging/Subsurface.app

echo -- signing Qt frameworks
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtCore.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtGui.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtNetwork.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtScript.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtSql.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtSvg.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtWebKit.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtMultimedia.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtMultimediaWidgets.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtOpenGL.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtPositioning.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtPrintSupport.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtQml.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtQuick.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtSensors.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtWebKitWidgets.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtWidgets.framework/
codesign --verbose --force -s G2PU7Q4ELP staging/Subsurface.app/Contents/Frameworks/QtXml.framework/

echo -- signing plugins
find staging/Subsurface.app/Contents -name \*.dylib | xargs codesign --verbose --force -s G2PU7Q4ELP

echo -- finally sign .app
codesign --verbose --force -s G2PU7Q4ELP -v staging/Subsurface.app/Contents/MacOS/Subsurface
codesign --verbose --force -s G2PU7Q4ELP -v staging/Subsurface.app
